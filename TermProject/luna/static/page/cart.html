<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>购物车</title>
    <link rel="stylesheet" href="/css/cart.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <style lang="">
        .cart-all {
            color: #3366D4;
        }

        .cart-bottom-btn {
            color: #FFF;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 20px;
            background: #FE8502;
            border: 1px solid #FF6633;
            border-radius: 5px 5px 5px 5px;
            padding: 6px 12px;
        }

        .cart-bottom-btn:hover {
            background: #FF6600;
        }
    </style>
</head>

<body data-spy="scroll" data-target="#myScrollspy" data-offset="10">
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
            aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            <a class="navbar-brand" href="home.html">小小书店</a>
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active">
                    <a class="nav-link" href="choose.html">全部分类</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="user.html">登录/注册</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link disabled" href="cart.html">购物车</a>
                </li>
            </ul>
            <span class=" navbar-text" id='time' style="margin-right: 20px;"> </span>
            <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
            </form>
        </div>
    </nav>

    <!-- 网页内容 -->
    <!-- <div class="my-3 p-3 bg-white rounded shadow-sm div">
        <div class="text-center">
            <h4>全部商品<span class="badge badge-secondary">New</span></h4>
        </div>
        <div class="text-center">
            <div>
                <table id="bookTable" class="table table-striped">
                    <thead>
                        <tr></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div>
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center" id="page">
                    </ul>
                </nav>
            </div>
        </div>
    </div> -->
    <div class="my-3 p-3 bg-white rounded shadow-sm div">
        <div class="cart">
            <div class="text-center">
                <h4>我的购物车<span class="badge badge-secondary">New</span></h4>
            </div>
            <!-- 数据表映射 -->
            <div class="text-center">
                <div>
                    <table id="bookTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th width="60"><span class="cart-all">全选</span></th>
                                <th>商品</th>
                                <th width="120">单价</th>
                                <th width="100">数量</th>
                                <th width="120">小计</th>
                                <th width="80">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="cart-item">
                                <td><input class="cart-check" type="checkbox" checked></td>
                                <td class="font-weight-bold cart-txt-left" style="color: #3366D4;"><span
                                        class="cart-name">Loading...</span></td>
                                <td><span class="cart-price">0</span></td>
                                <td class="d-flex">
                                    <span class="cart-reduce btn btn-outline-info btn-sm">-</span>
                                    <!-- <input type="text" value="1" class="form-control text-center" id="cartNum"
                                        maxlength="3"> -->
                                    <span class="cart-num form-control text-center">0</span>
                                    <span class="cart-add btn btn-outline-info btn-sm">+</span>
                                </td>
                                <td><span class="font-weight-bold text-danger cart-subtotal">0</span></td>
                                <td><span class="cart-del text-primary">删除</span></td>
                            </tr>
                            <tr class="cart-bottom">
                                <td colspan="6">
                                    <span class="cart-bottom-span">已选择 <span class="cart-total-num">0</span> 件商品</span>
                                    <span class="cart-bottom-span ">总计：<span class="cart-total-price font-weight-bold"
                                            style="color: #FF3334;font-size: 23px;">0</span></span>
                                    <span class="cart-bottom-btn">提交订单</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <nav aria-label="Page navigation example">
                        <ul class="pagination justify-content-center" id="page">
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- <div class="gouwuche-footer">
        <div class="row">
            <div class="col-md-2">
            </div>
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-6">
                        <input type="checkbox" id="checkAll">全选</span>
                    </div>
                    <div class="col-md-2" id="gouwuche-all-goods">
                        <span>已选择<span class="gouwuche-all-goods-num" id="all-goods-num">5</span>件商品</span>
                    </div>
                    <div class="col-md-2" id="gouwuche-all-sum">
                        <span>总价</span><span class="gouwuche-money-biaoshi">¥</span><span
                            class="gouwuche-all-money">200</span>
                    </div>
                    <div class="col-md-2" id="gouwuche-pay">
                        <button type="button" class="btn btn-info">结算</button>
                    </div>
                </div>
            </div>


            <div class="col-md-2">
            </div>
        </div>
    </div> -->

    <script src="/js/jquery-3.6.0.min.js"></script>
    <!-- <script>
        var maxPage;
        var currentPage = 1;
        window.onload = function () {
            // 拿到数据
            // getData();
            // 加载有多少个分页，还要思考一点，当初次渲染的时候应该显示多少条数据
            getPageTotal();
            // ============点击第几页就显示第几页的数据============
            choosePage(currentPage);
        }

        // ============点击第几页就显示第几页的数据============start
        function choosePage(num) {
            currentPage = num;
            console.log("choosePage#1" + num);
            $.ajax({
                type: "post",
                url: "/getPageData.do",
                data: {
                    pageNum: num,
                    pageDataNum: 3
                },
                success(data) {
                    console.log("choosePage#2" + data);
                    showBook(data);
                }
            });
        }
        // ============上一页的方法
        function prePage() {
            if (currentPage > 1) {
                choosePage(currentPage - 1);
            }
        }
        // ============下一页的方法
        function nextPage() {
            if (currentPage < maxPage) {
                choosePage(currentPage + 1);
            }
        }
        // ============点击第几页就显示第几页的数据============end


        // ============请求一共有多少页的方法============
        function getPageTotal() {
            // 请求数据库的数据一共有多少条(多少页)
            $("#page").html("");
            $.ajax({
                type: "post",
                url: "/getPage.do",
                success(data) {
                    console.log("getPageTotal#1" + data);
                    maxPage = Math.ceil(data[0].pageNum / 3);
                    $("#page").append(`<li class="page-item"><button type="button" onclick="prePage()" class="page-link">上一页</button></li>`);
                    for (var i = 1; i <= maxPage; i++) {
                        $('#page').append(`<li class="page-item"><button type="button" onclick="choosePage(${i})" class="btn page-link">${i}</button></li>`);
                    };
                    $("#page").append(`<li class="page-item"><button type="button" onclick="nextPage()" class="btn page-link">下一页</button></li>`);
                }
            });
        }


        //  ============页面渲染============

        // ============渲染数据的方法============start
        function showBook(data) {
            data = JSON.parse(data);
            console.log(typeof data);
            $("#bookTable thead tr").html("");
            $("#bookTable tbody").html("");
            // ============渲染表头============
            $("#bookTable thead tr").append(`<th>选中状态</th>`);
            for (item in data[0]) {
                // item属性名
                $("#bookTable thead tr").append(`<th>${item}</th>`);
            }
            $("#bookTable thead tr").append(`<th>操作</th>`);
            // ============渲染表数据============
            $.each(data, (home, item) => {
                if (item['图书信息'] == null) {
                    item['图书信息'] = '未加入';
                }
                $("#bookTable tbody").append(`
                <tr>
                    <td><input type="checkbox" name="cartCheck" id="cartCheck"></td> 
                    <td>${item['图书ID']}</td>
                    <td>${item['图书名']}</td>      
                    <td>${item['图书价格']}</td>  
                    <td>${item['图书信息']}</td>  
                    <td>
                        <button class="btn btn-danger" onclick="deleteBook(${item['图书ID']})">删除</button>
                    </td> 
                </tr>
            `)
            });
        }
        // ============渲染数据的方法============end


        // ============往第一个模态框里传值============start
        function byvalue(obj) {
            $('#bookTable tbody').on('click', 'tr', function () //鼠标点击监听
            {
                console.log("byvalue#1" + $(this).children());
                var arr = $(this).children();
                console.log("byvalue#2" + arr.eq(0).text());
                $("#bookId").val(arr.eq(0).text());
                $("#bookName").val(arr.eq(1).text());
                $("#bookValue").val(arr.eq(2).text());
                $("#bookMessage").val(arr.eq(3).text());
                $("#thepark").val(arr.eq(4).text());
                $("#parkDesc").val(arr.eq(5).text());
            });
        }
        // ============往第一个模态框里传值============end


        /* // ============删除指定行的信息============start
        function deleteBook(bookId) {
            // 1、获取ajax对象
            $.ajax({
                type: "post",
                url: "/delBookPost.do",
                data: {
                    bookId: bookId
                },
                success(data) {
                    console.log("deleteBook#1" + data);
                    // showBook(data);
                    // getData();
                    // getPageTotal();
                    getPageTotal();
                    choosePage(1);
                }
            });
        }
        // ============删除指定行的信息============end


        // ============多条件搜素============start
        function searchBook() {
            let bookName = $("#bookName").val();
            let bookValue = $("#bookValue").val();
            let bookMessage = $("#bookMessage").val();
            let thepark1 = $("#thepark1").val();
            let parkDesc1 = $("#parkDesc1").val();
            $.ajax({
                type: "post",
                url: "/searchBook.do",
                data: {
                    bookName: bookName,
                    bookValue: bookValue,
                    bookMessage: bookMessage,
                    thepark1: thepark1,
                    parkDesc1: parkDesc1
                },
                success(data) {
                    console.log("searchBook#1" + data);
                    showBook(data);
                    // getPageTotal();
                    // getData(data);
                }
            })
        }
        // ============多条件搜素============end


        // ============查询所有============start
        function queryBook() {
            $.ajax({
                type: "post",
                url: "/queryBook.do",
                success(data) {
                    console.log("queryBook#1" + data);
                    getPageTotal();
                    choosePage(1);
                }
            })
        }
        // ============查询所有============end

        // ============查询单个============start
        function toQueryOne() {
            let bookId = $("#bookId").val();
            let bookName = $("#bookName").val();
            $.ajax({
                type: "post",
                url: "/queryOneBook.do",
                data: {
                    bookId: bookId,
                    bookName: bookName
                },
                success(data) {
                    console.log("toQueryOne#1" + data);
                    showBook(data);
                    // getPageTotal();
                    // getData(data);
                }
            })
        }
        // ============查询单个============end */
    </script> -->
    <script>
        $(function () {
            $("#checkAll").click(function () {
                $(":checkbox[name='cartCheck']").prop("checked", this.checked); // this指代的你当前选择的这个元素的JS对象
            });
        });
    </script>
    <script>
        var arr = [];
        function getBook() {
            $.ajax({
                type: "post",
                url: "/getBook.do",
                success(data) {
                    for (var p in data) {
                        arr.push(data[p]);
                    }
                }
            });
        }
        getBook();
        console.log(arr);
    </script>
    <script src="/js/cart.js"></script>

    <script>
        setTimeout(function () {
            ShopCart(
                'cart', arr
            );
        }, 100);

    </script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
        integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2"
        crossorigin="anonymous"></script>

</body>

</html>